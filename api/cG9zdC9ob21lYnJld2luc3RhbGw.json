{"title":"Homebrewの安装教程","date":"2023-08-06T14:06:08.000Z","date_formatted":{"ll":"Aug 6, 2023","L":"08/06/2023","MM-DD":"08-06"},"thumbnail":"https://cdn.cco.moe/img/img01.webp","link":"post/homebrewinstall","comments":true,"tags":["macOS"],"categories":["share"],"updated":"2023-12-06T17:29:10.688Z","content":"<p>Homebrew相当于macOS的第二App Store，虽称为第二，但是软件生态却要比App Store丰富得多，大量在App Store中没有收录的软件都可以用Homebrew进行安装。</p>\n<span id=\"more\"></span>\n<p>也正因如此，开发者们几乎都愿意将自己开发的软件上传到Homebrew中，这就使得Homebrew的软件生态越来越大，甚至让苹果公司也愿意帮助Homebrew开发团队攻克基于Apple Silicon开发的难题 <em>(毕竟对苹果自家的Mac而言没有坏处，甚至成为Mac的一大亮点)</em> 。</p>\n<p>Homebrew由于其本身的源在国外，在国内使用官方源的体验并不是很好(Clash X Pro同时开启系统代理和增强模式可使terminal也用上代理)，所以我使用的是清华源的Homebrew，接下来详细介绍清华源Homebrew的安装教程 <em>(其实是防止自己脑袋不够用怕忘掉)</em> 。 <em>(Apple Silicon, Macbook air M1, macOS Monterey, zsh.)</em></p>\n<h2 id=\"配置环境变量\">配置环境变量<a title=\"#配置环境变量\" href=\"#配置环境变量\"></a></h2>\n<p>首先，cd到个人目录(~)新建一个 <strong>.zprofile</strong> 文件：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> ~</span><br><span class=\"line\"><span class=\"built_in\">touch</span> .zprofile  <span class=\"comment\"># 默认shell为zsh使用该命令</span></span><br></pre></td></tr></table></figure>\n<p>然后，将 brew 程序的相关路径加入到环境变量中。以下针对基于 Apple Silicon CPU 设备上的 macOS 系统 <em>(命令行运行 uname -m 应输出 arm64)</em> 上的 Homebrew ：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">test</span> -r ~/.zprofile &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;eval &quot;$(/opt/homebrew/bin/brew shellenv)&quot;&#x27;</span>&gt;&gt; ~/.zprofile</span><br></pre></td></tr></table></figure>\n<p><em>tips: macOS Monterey的默认Shell是zsh, 在用户目录(~)中有 .zprofile , 没有 .bash_profile , 所以只需在终端中运行第二条命令即可。</em></p>\n<p>也可以直接在 <strong>.zprofile</strong> 文件中直接添加以下代码：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"string\">&quot;<span class=\"subst\">$(/opt/homebrew/bin/brew shellenv)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"安装homebrew\">安装Homebrew<a title=\"#安装homebrew\" href=\"#安装homebrew\"></a></h2>\n<p>然后，需要通过安装脚本安装Homebrew，安装完成之后再通过修改环境变量的方式来修改镜像源。其中两种安装脚本，分别是清华源和官方的安装脚本 <em>(在终端中执行以下任一种即可)</em> ：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 从清华源镜像站下载安装脚本并安装 Homebrew </span></span><br><span class=\"line\"><span class=\"comment\"># 三条命令，分行运行</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> --depth=1 https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/install.git brew-install</span><br><span class=\"line\">/bin/bash brew-install/install.sh</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf brew-install</span><br><span class=\"line\"><span class=\"comment\"># 从 GitHub 获取官方安装脚本安装 Homebrew </span></span><br><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://github.com/Homebrew/install/raw/master/install.sh)</span>&quot;</span> </span><br></pre></td></tr></table></figure>\n<h2 id=\"更换镜像源\">更换镜像源<a title=\"#更换镜像源\" href=\"#更换镜像源\"></a></h2>\n<p>然后在 <strong>.zprofile</strong> 文件中手动添加以下环境变量即可更换Homebrew的镜像源：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_API_DOMAIN=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_BOTTLE_DOMAIN=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_BREW_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_PIP_INDEX_URL=<span class=\"string\">&quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;</span></span><br></pre></td></tr></table></figure>\n<p>也可以在终端直接运行以下命令即可添加环境变量到 <strong>.zprofile</strong> 文件中：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">test</span> -r ~/.zprofile &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_API_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/api&quot;&#x27;</span> &gt;&gt; ~/.zprofile</span><br><span class=\"line\"><span class=\"built_in\">test</span> -r ~/.zprofile &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BOTTLE_DOMAIN=&quot;https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles&#x27;</span> &gt;&gt; ~/.zprofile</span><br><span class=\"line\"><span class=\"built_in\">test</span> -r ~/.zprofile &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BREW_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git&quot;&#x27;</span> &gt;&gt; ~/.zprofile</span><br><span class=\"line\"><span class=\"built_in\">test</span> -r ~/.zprofile &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_CORE_GIT_REMOTE=&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;&#x27;</span> &gt;&gt; ~/.zprofile</span><br><span class=\"line\"><span class=\"built_in\">test</span> -r ~/.zprofile &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_PIP_INDEX_URL=&quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;&#x27;</span> &gt;&gt; ~/.zprofile</span><br></pre></td></tr></table></figure>\n<p><em>tips: 自brew 4.0.0 (2023 年 2 月 16日) 起，HOMEBREW_INSTALL_FROM_API 会成为默认行为，无需设置。大部分用户无需再克隆 homebrew-core 仓库，故无需设置 HOMEBREW_CORE_GIT_REMOTE 环境变量；但若需要运行 brew 的开发命令或者 brew 安装在非官方支持的默认 prefix 位置，则仍需设置 HOMEBREW_CORE_GIT_REMOTE 环境变量。如果不想通过 API 安装，可以设置 HOMEBREW_NO_INSTALL_FROM_API=1。</em></p>\n<h2 id=\"配置tap仓库镜像源\">配置tap仓库镜像源<a title=\"#配置tap仓库镜像源\" href=\"#配置tap仓库镜像源\"></a></h2>\n<p>然后重启terminal <em>(重启terminal之后，环境变量即可生效)</em> ，针对macOS系统上的Homebrew更换tap仓库的镜像源 <em>(此处最好将对应文件删除后再执行以下代码)</em> ：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># tips：自 brew 4.0 起，大部分 Homebrew 用户无需设置 homebrew/core 和 homebrew/cask 镜像，只需设置 HOMEBREW_API_DOMAIN 即可。</span></span><br><span class=\"line\"><span class=\"comment\"># 如果需要使用 Homebrew 的开发命令 (如 `brew cat &lt;formula&gt;`)，则仍然需要设置 homebrew/core 和 homebrew/cask 镜像。</span></span><br><span class=\"line\"><span class=\"comment\"># 请按需执行如下两行命令(日常用的话不需要执行)：</span></span><br><span class=\"line\">brew tap --custom-remote --force-auto-update homebrew/core https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br><span class=\"line\">brew tap --custom-remote --force-auto-update homebrew/cask https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-cask.git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 除 homebrew/core 和 homebrew/cask 仓库外的 tap 仓库仍然需要设置镜像</span></span><br><span class=\"line\">brew tap --custom-remote --force-auto-update homebrew/cask-fonts https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-cask-fonts.git</span><br><span class=\"line\">brew tap --custom-remote --force-auto-update homebrew/cask-versions https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-cask-versions.git</span><br><span class=\"line\">brew tap --custom-remote --force-auto-update homebrew/command-not-found https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-command-not-found.git</span><br><span class=\"line\">brew tap --custom-remote --force-auto-update homebrew/services https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-services.git</span><br><span class=\"line\">brew update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或使用下面的几行命令自动设置</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HOMEBREW_CORE_GIT_REMOTE=<span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git&quot;</span></span><br><span class=\"line\">fortapincore cask&#123;,-fonts,-versions&#125; command-not-found services;<span class=\"keyword\">do</span></span><br><span class=\"line\">brew tap --custom-remote --force-auto-update <span class=\"string\">&quot;homebrew/<span class=\"variable\">$&#123;tap&#125;</span>&quot;</span> <span class=\"string\">&quot;https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-<span class=\"variable\">$&#123;tap&#125;</span>.git&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\">brew update</span><br></pre></td></tr></table></figure>\n<p>重启终端，安装完成，enjoy…</p>\n<h2 id=\"复原官方源\">复原官方源<a title=\"#复原官方源\" href=\"#复原官方源\"></a></h2>\n<p>如果想要复原官方的镜像源，可以在终端运行以下代码 <em>(只针对于macOS上的Homebrew)</em> ：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 对于 brew 程序本身</span></span><br><span class=\"line\"><span class=\"built_in\">unset</span> HOMEBREW_BREW_GIT_REMOTE</span><br><span class=\"line\">git -C <span class=\"string\">&quot;<span class=\"subst\">$(brew --repo)</span>&quot;</span> remote set-url origin https://github.com/Homebrew/brew</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下针对 macOS 系统上的 Homebrew </span></span><br><span class=\"line\"><span class=\"built_in\">unset</span> HOMEBREW_API_DOMAIN</span><br><span class=\"line\"><span class=\"built_in\">unset</span> HOMEBREW_CORE_GIT_REMOTE</span><br><span class=\"line\">BREW_TAPS=<span class=\"string\">&quot;<span class=\"subst\">$(BREW_TAPS=<span class=\"string\">&quot;<span class=\"subst\">$(brew tap 2&gt;/dev/null)</span>&quot;</span>; echo -n <span class=\"string\">&quot;<span class=\"variable\">$&#123;BREW_TAPS//$&#x27;\\n&#x27;/:&#125;</span>&quot;</span>)</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> tap <span class=\"keyword\">in</span> core cask&#123;,-fonts,-versions&#125; command-not-found services; <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">&quot;:<span class=\"variable\">$&#123;BREW_TAPS&#125;</span>:&quot;</span> == *<span class=\"string\">&quot;:homebrew/<span class=\"variable\">$&#123;tap&#125;</span>:&quot;</span>* ]]; <span class=\"keyword\">then</span>  <span class=\"comment\"># 只复原已安装的 Tap</span></span><br><span class=\"line\">        brew tap --custom-remote <span class=\"string\">&quot;homebrew/<span class=\"variable\">$&#123;tap&#125;</span>&quot;</span> <span class=\"string\">&quot;https://github.com/Homebrew/homebrew-<span class=\"variable\">$&#123;tap&#125;</span>&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重新拉取远程</span></span><br><span class=\"line\">brew update</span><br></pre></td></tr></table></figure>\n<p>本文参考了清华大学镜像站，另外 <strong>Linuxbrew</strong> 安装详见 <a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/\" target=\"_blank\">https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/</a> . 不许转载😡！！！</p>\n","prev":{"title":"前期准备-Web前端","link":"post/webpre"},"next":{"title":"Blog Building","link":"post/blogbuilding"},"plink":"http://example.com/post/homebrewinstall/","toc":[{"id":"配置环境变量","title":"配置环境变量","index":"1"},{"id":"安装homebrew","title":"安装Homebrew","index":"2"},{"id":"更换镜像源","title":"更换镜像源","index":"3"},{"id":"配置tap仓库镜像源","title":"配置tap仓库镜像源","index":"4"},{"id":"复原官方源","title":"复原官方源","index":"5"}],"reward":true,"copyright":{"author":"chromoe","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"August 6, 2023"},"reading_time":"1431 words in 10 min"}